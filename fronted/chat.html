<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroSense Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            --message-self: linear-gradient(135deg, #667eea, #764ba2);
            --message-other: linear-gradient(135deg, #f5f7fa, #e4e8f0);
            --bg-light: #f8f9fa;
            --bg-white: #ffffff;
            --text-dark: #2d3748;
            --text-light: #718096;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            background: var(--primary-gradient);
            height: 100vh;
            overflow: hidden;
        }
        
        .chat-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--bg-white);
            position: relative;
            overflow: hidden;
        }
        
        /* Header */
        .chat-header {
            background: var(--primary-gradient);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            flex-shrink: 0;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .logo-text h1 {
            font-size: 1.6rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        .logo-text p {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 2px;
        }
        
        .connection-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4ade80;
            position: relative;
        }
        
        .status-dot::after {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 50%;
            background: rgba(74, 222, 128, 0.3);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        
        /* Messages Area */
        .messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: var(--bg-light);
            position: relative;
        }
        
        .messages-wrapper {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Message Bubbles */
        .message-bubble {
            max-width: 65%;
            display: flex;
            animation: slideIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            position: relative;
        }
        
        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(20px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        .message-bubble.self {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .message-bubble.other {
            align-self: flex-start;
        }
        
        .message-content {
            padding: 16px 20px;
            border-radius: 22px;
            font-size: 1rem;
            line-height: 1.5;
            position: relative;
            word-wrap: break-word;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }
        
        .message-bubble.self .message-content {
            background: var(--message-self);
            color: white;
            border-bottom-right-radius: 8px;
        }
        
        .message-bubble.other .message-content {
            background: var(--bg-white);
            color: var(--text-dark);
            border-bottom-left-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        /* Anonymous Avatar */
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 12px;
            align-self: flex-end;
            flex-shrink: 0;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .message-bubble.self .avatar {
            background: var(--primary-gradient);
        }
        
        .message-bubble.other .avatar {
            background: linear-gradient(135deg, #a78bfa, #8b5cf6);
        }
        
        .avatar i {
            font-size: 18px;
            color: white;
        }
        
        /* Message Time */
        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 6px;
            text-align: right;
            padding: 0 5px;
        }
        
        .message-bubble.self .message-time {
            text-align: left;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .message-bubble.other .message-time {
            color: var(--text-light);
        }
        
        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 40px;
            animation: fadeIn 1s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .welcome-icon {
            width: 100px;
            height: 100px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        }
        
        .welcome-icon i {
            font-size: 40px;
            color: white;
        }
        
        .welcome-text h2 {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 15px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .welcome-text p {
            font-size: 1.1rem;
            color: var(--text-light);
            line-height: 1.6;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(102, 126, 234, 0.1);
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 25px;
            font-size: 0.9rem;
            color: #667eea;
        }
        
        /* Typing Indicator */
        .typing-indicator {
            display: none;
            align-items: center;
            gap: 12px;
            padding: 15px 25px;
            background: var(--bg-white);
            border-radius: 25px;
            width: fit-content;
            margin: 0 auto 20px;
            box-shadow: var(--shadow);
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .typing-dots {
            display: flex;
            gap: 5px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: typingBounce 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }
        
        /* Input Area */
        .input-area {
            padding: 25px 30px;
            background: var(--bg-white);
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.05);
            flex-shrink: 0;
            z-index: 100;
        }
        
        .input-wrapper {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            gap: 15px;
            align-items: flex-end;
        }
        
        .message-input {
            flex: 1;
            padding: 18px 24px;
            border: 2px solid #e2e8f0;
            border-radius: 18px;
            font-size: 1.05rem;
            resize: none;
            height: 60px;
            min-height: 60px;
            max-height: 120px;
            transition: all 0.3s;
            background: var(--bg-light);
            color: var(--text-dark);
        }
        
        .message-input:focus {
            outline: none;
            border-color: #667eea;
            background: var(--bg-white);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .message-input::placeholder {
            color: #a0aec0;
        }
        
        .send-button {
            width: 60px;
            height: 60px;
            border-radius: 18px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .send-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        
        .send-button i {
            font-size: 20px;
            transition: transform 0.3s;
        }
        
        .send-button:hover i {
            transform: translateX(3px);
        }
        
        /* Scrollbar Styling */
        .messages-area::-webkit-scrollbar {
            width: 6px;
        }
        
        .messages-area::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .messages-area::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.3);
            border-radius: 3px;
        }
        
        .messages-area::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.5);
        }
        
        /* System Message */
        .system-message {
            text-align: center;
            margin: 20px auto;
            max-width: 600px;
        }
        
        .system-message .message-content {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            font-size: 0.9rem;
            padding: 12px 24px;
            border-radius: 15px;
            border: none;
            box-shadow: none;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .chat-header {
                padding: 15px 20px;
            }
            
            .logo-text h1 {
                font-size: 1.3rem;
            }
            
            .messages-area {
                padding: 20px;
            }
            
            .message-bubble {
                max-width: 80%;
            }
            
            .input-area {
                padding: 20px;
            }
            
            .message-input {
                padding: 15px 20px;
                font-size: 1rem;
            }
            
            .welcome-icon {
                width: 80px;
                height: 80px;
            }
            
            .welcome-icon i {
                font-size: 32px;
            }
            
            .welcome-text h2 {
                font-size: 1.8rem;
            }
        }
        
        @media (max-width: 480px) {
            .chat-header {
                padding: 12px 15px;
            }
            
            .logo-icon {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
            
            .logo-text h1 {
                font-size: 1.1rem;
            }
            
            .logo-text p {
                font-size: 0.75rem;
            }
            
            .messages-area {
                padding: 15px;
            }
            
            .message-bubble {
                max-width: 90%;
            }
            
            .message-content {
                padding: 14px 18px;
                font-size: 0.95rem;
            }
            
            .avatar {
                width: 36px;
                height: 36px;
                margin: 0 8px;
            }
            
            .input-area {
                padding: 15px;
            }
            
            .input-wrapper {
                gap: 10px;
            }
            
            .message-input {
                padding: 14px 18px;
                height: 56px;
                min-height: 56px;
            }
            
            .send-button {
                width: 56px;
                height: 56px;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <!-- Header -->
        <div class="chat-header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="logo-text">
                    <h1>NeuroSense Support</h1>
                    <p>Anonymous • Secure • 24/7</p>
                </div>
            </div>
            <div class="connection-info">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>Secure Connection</span>
                </div>
            </div>
        </div>
        
        <!-- Messages Area -->
        <div class="messages-area" id="messagesArea">
            <div class="messages-wrapper" id="messagesWrapper">
                <!-- Welcome Screen -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="welcome-text">
                        <h2>Anonymous Support Chat</h2>
                        <p>You're connected to a safe, anonymous space where you can share freely without judgment. Your identity is completely protected.</p>
                        <div class="security-badge">
                            <i class="fas fa-lock"></i>
                            <span>End-to-End Encrypted</span>
                        </div>
                    </div>
                </div>
                
                <!-- Messages will be inserted here -->
            </div>
        </div>
        
        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
            <span>Someone is typing...</span>
        </div>
        
        <!-- Input Area -->
        <div class="input-area">
            <div class="input-wrapper">
                <textarea 
                    class="message-input" 
                    id="messageInput" 
                    placeholder="Share your thoughts... (Press Enter to send)"
                    rows="1"
                ></textarea>
                <button class="send-button" id="sendButton">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Chat Configuration
        const CONFIG = {
            BACKEND_URL: 'http://localhost:3000/api',
            WS_URL: 'ws://localhost:3000/ws',
            
            // Colors for different anonymous avatars
            AVATAR_COLORS: [
                'linear-gradient(135deg, #667eea, #764ba2)',
                'linear-gradient(135deg, #f56565, #ed8936)',
                'linear-gradient(135deg, #48bb78, #38a169)',
                'linear-gradient(135deg, #4299e1, #3182ce)',
                'linear-gradient(135deg, #9f7aea, #805ad5)',
                'linear-gradient(135deg, #ed64a6, #d53f8c)'
            ],
            
            // Avatar icons (no names)
            AVATAR_ICONS: [
                'fas fa-user',
                'fas fa-user-circle',
                'fas fa-user-friends',
                'fas fa-user-nurse',
                'fas fa-user-injured',
                'fas fa-user-clock'
            ]
        };
        
        // Chat State
        const state = {
            messages: [],
            isTyping: false,
            typingUsers: new Set(),
            ws: null,
            userId: 'user_' + Math.random().toString(36).substring(2, 12),
            userAvatar: {
                color: CONFIG.AVATAR_COLORS[Math.floor(Math.random() * CONFIG.AVATAR_COLORS.length)],
                icon: CONFIG.AVATAR_ICONS[Math.floor(Math.random() * CONFIG.AVATAR_ICONS.length)]
            }
        };
        
        // DOM Elements
        const elements = {
            messagesArea: document.getElementById('messagesArea'),
            messagesWrapper: document.getElementById('messagesWrapper'),
            welcomeScreen: document.getElementById('welcomeScreen'),
            messageInput: document.getElementById('messageInput'),
            sendButton: document.getElementById('sendButton'),
            typingIndicator: document.getElementById('typingIndicator')
        };
        
        // Initialize Chat
        document.addEventListener('DOMContentLoaded', initChat);
        
        function initChat() {
            setupEventListeners();
            connectToChat();
        }
        
        function setupEventListeners() {
            // Send message on button click
            elements.sendButton.addEventListener('click', sendMessage);
            
            // Send message on Enter (but allow Shift+Enter for new line)
            elements.messageInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
                
                // Show typing indicator
                if (!state.isTyping) {
                    state.isTyping = true;
                    showTypingIndicator(true);
                }
                
                // Clear typing timeout
                clearTimeout(state.typingTimeout);
                state.typingTimeout = setTimeout(() => {
                    state.isTyping = false;
                    showTypingIndicator(false);
                }, 2000);
            });
            
            // Auto-resize textarea
            elements.messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });
        }
        
        function connectToChat() {
            // In production: Connect to WebSocket backend
            // connectWebSocket();
            
            // For demo: Simulate connection
            simulateChatConnection();
        }
        
        function simulateChatConnection() {
            setTimeout(() => {
                addSystemMessage("You've joined the secure support chat");
                
                // Simulate other users' messages
                setTimeout(() => {
                    addMessage({
                        id: '1',
                        userId: 'other_1',
                        content: 'Hello everyone. Having a tough day today.',
                        timestamp: new Date(Date.now() - 300000).toISOString(),
                        isOwn: false,
                        avatar: {
                            color: CONFIG.AVATAR_COLORS[1],
                            icon: CONFIG.AVATAR_ICONS[1]
                        }
                    });
                }, 1500);
                
                setTimeout(() => {
                    addMessage({
                        id: '2',
                        userId: 'other_2',
                        content: 'I understand. Some days are harder than others. What\'s been on your mind?',
                        timestamp: new Date(Date.now() - 180000).toISOString(),
                        isOwn: false,
                        avatar: {
                            color: CONFIG.AVATAR_COLORS[2],
                            icon: CONFIG.AVATAR_ICONS[2]
                        }
                    });
                }, 3000);
                
            }, 1000);
        }
        
        function sendMessage() {
            const content = elements.messageInput.value.trim();
            if (!content) return;
            
            // Create message object
            const message = {
                id: Date.now().toString(),
                userId: state.userId,
                content: content,
                timestamp: new Date().toISOString(),
                isOwn: true,
                avatar: state.userAvatar
            };
            
            // Add to UI
            addMessage(message);
            
            // Clear input
            elements.messageInput.value = '';
            elements.messageInput.style.height = '60px';
            elements.messageInput.focus();
            
            // Hide typing indicator
            state.isTyping = false;
            showTypingIndicator(false);
            
            // In production: Send to backend
            // sendToBackend(message);
            
            // Simulate response
            simulateResponse();
        }
        
        function addMessage(message) {
            // Hide welcome screen on first message
            if (message.isOwn && state.messages.length === 0) {
                elements.welcomeScreen.style.display = 'none';
            }
            
            // Create message element
            const messageDiv = document.createElement('div');
            messageDiv.className = `message-bubble ${message.isOwn ? 'self' : 'other'}`;
            
            // Format time
            const time = formatTime(message.timestamp);
            
            // Create avatar
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'avatar';
            avatarDiv.style.background = message.avatar.color;
            avatarDiv.innerHTML = `<i class="${message.avatar.icon}"></i>`;
            
            // Create content
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = message.content;
            
            // Create time
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = time;
            
            // Assemble message
            if (message.isOwn) {
                messageDiv.appendChild(contentDiv);
                messageDiv.appendChild(avatarDiv);
                messageDiv.appendChild(timeDiv);
            } else {
                messageDiv.appendChild(avatarDiv);
                messageDiv.appendChild(contentDiv);
                messageDiv.appendChild(timeDiv);
            }
            
            // Add to wrapper
            elements.messagesWrapper.appendChild(messageDiv);
            
            // Scroll to bottom
            elements.messagesArea.scrollTop = elements.messagesArea.scrollHeight;
            
            // Add to state
            state.messages.push(message);
        }
        
        function addSystemMessage(text) {
            const systemDiv = document.createElement('div');
            systemDiv.className = 'system-message';
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = text;
            
            systemDiv.appendChild(contentDiv);
            elements.messagesWrapper.appendChild(systemDiv);
            
            // Scroll to bottom
            elements.messagesArea.scrollTop = elements.messagesArea.scrollHeight;
        }
        
        function showTypingIndicator(show) {
            if (show) {
                elements.typingIndicator.style.display = 'flex';
                elements.typingIndicator.style.animation = 'slideUp 0.3s ease';
            } else {
                elements.typingIndicator.style.display = 'none';
            }
        }
        
        function simulateResponse() {
            // Only simulate sometimes
            if (Math.random() < 0.6) return;
            
            // Simulate typing indicator
            setTimeout(() => {
                showTypingIndicator(true);
            }, 800);
            
            // Simulate response after delay
            setTimeout(() => {
                showTypingIndicator(false);
                
                const responses = [
                    'Thanks for sharing. It helps to talk about these things.',
                    'I understand how you feel. You\'re not alone in this.',
                    'That sounds really difficult. How are you coping with it?',
                    'Thank you for being open. Many of us have similar experiences.',
                    'I appreciate your honesty. Remember to be kind to yourself today.'
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                addMessage({
                    id: Date.now().toString(),
                    userId: 'other_' + Math.floor(Math.random() * 100),
                    content: randomResponse,
                    timestamp: new Date().toISOString(),
                    isOwn: false,
                    avatar: {
                        color: CONFIG.AVATAR_COLORS[Math.floor(Math.random() * CONFIG.AVATAR_COLORS.length)],
                        icon: CONFIG.AVATAR_ICONS[Math.floor(Math.random() * CONFIG.AVATAR_ICONS.length)]
                    }
                });
            }, 2000 + Math.random() * 2000);
        }
        
        // Helper Functions
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        // Backend Integration Functions (for production)
        function connectWebSocket() {
            state.ws = new WebSocket(CONFIG.WS_URL);
            
            state.ws.onopen = () => {
                console.log('WebSocket connected');
                // Send join message
                state.ws.send(JSON.stringify({
                    type: 'join',
                    userId: state.userId,
                    avatar: state.userAvatar
                }));
            };
            
            state.ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleWebSocketMessage(data);
            };
            
            state.ws.onclose = () => {
                console.log('WebSocket disconnected');
                setTimeout(connectWebSocket, 3000);
            };
        }
        
        function handleWebSocketMessage(data) {
            switch(data.type) {
                case 'message':
                    addMessage({
                        ...data.message,
                        isOwn: data.message.userId === state.userId
                    });
                    break;
                    
                case 'typing':
                    if (data.userId !== state.userId) {
                        if (data.isTyping) {
                            state.typingUsers.add(data.userId);
                            showTypingIndicator(true);
                        } else {
                            state.typingUsers.delete(data.userId);
                            if (state.typingUsers.size === 0) {
                                showTypingIndicator(false);
                            }
                        }
                    }
                    break;
                    
                case 'user_joined':
                    addSystemMessage('Someone joined the chat');
                    break;
                    
                case 'user_left':
                    addSystemMessage('Someone left the chat');
                    break;
                    
                case 'system':
                    addSystemMessage(data.message);
                    break;
            }
        }
        
        function sendToBackend(message) {
            // Send via WebSocket if connected
            if (state.ws && state.ws.readyState === WebSocket.OPEN) {
                state.ws.send(JSON.stringify({
                    type: 'message',
                    message: message
                }));
            } 
            // Fallback to HTTP
            else {
                fetch(CONFIG.BACKEND_URL + '/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(message)
                });
            }
        }
    </script>
</body>
</html>